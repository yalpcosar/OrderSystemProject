<div class="product-form-container">
  <div class="form-header">
    <div class="title-section">
      <h1>{{ isEditMode ? ('PRODUCTS.EDIT_PRODUCT' | translate) : ('PRODUCTS.ADD_PRODUCT' | translate) }}</h1>
      <p class="subtitle">
        {{ isEditMode ? ('PRODUCTS.EDIT_PRODUCT_DESCRIPTION' | translate) : ('PRODUCTS.ADD_PRODUCT_DESCRIPTION' | translate) }}
      </p>
    </div>
    
    <div class="actions-section">
      <button 
        mat-button 
        (click)="onCancel()"
        class="cancel-button">
        <mat-icon>arrow_back</mat-icon>
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>

  <div class="form-content" *ngIf="!isLoading">
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
      
      <!-- Product Name -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'PRODUCTS.NAME' | translate }}</mat-label>
        <input 
          matInput 
          formControlName="name"
          placeholder="{{ 'PRODUCTS.NAME_PLACEHOLDER' | translate }}">
        <mat-error *ngIf="isFieldInvalid('name')">
          {{ getErrorMessage('name') }}
        </mat-error>
      </mat-form-field>

      <!-- Color Selection -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="color-field">
          <mat-label>{{ 'PRODUCTS.COLOR' | translate }}</mat-label>
          <mat-select formControlName="colorId">
            <mat-option *ngFor="let color of colors" [value]="color.id">
              <div class="color-option">
                <div 
                  class="color-preview" 
                  [style.background-color]="color.hexCode">
                </div>
                <span>{{ color.name }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="isFieldInvalid('colorId')">
            {{ getErrorMessage('colorId') }}
          </mat-error>
        </mat-form-field>

        <button 
          type="button"
          mat-stroked-button 
          color="primary"
          (click)="openColorDialog()"
          class="manage-colors-button">
          <mat-icon>palette</mat-icon>
          {{ 'PRODUCTS.MANAGE_COLORS' | translate }}
        </button>
      </div>

      <!-- Size Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'PRODUCTS.SIZE' | translate }}</mat-label>
        <mat-select formControlName="size">
          <mat-option *ngFor="let size of sizeOptions" [value]="size.value">
            {{ size.label }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="isFieldInvalid('size')">
          {{ getErrorMessage('size') }}
        </mat-error>
      </mat-form-field>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="button"
          mat-button 
          (click)="onCancel()"
          class="cancel-action">
          {{ 'COMMON.CANCEL' | translate }}
        </button>
        
        <button 
          type="submit"
          mat-raised-button 
          color="primary"
          [disabled]="productForm.invalid || isLoading"
          class="submit-action">
          <mat-icon *ngIf="isLoading" class="spinning">refresh</mat-icon>
          <mat-icon *ngIf="!isLoading">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
          {{ isEditMode ? ('COMMON.UPDATE' | translate) : ('COMMON.CREATE' | translate) }}
        </button>
      </div>
    </form>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>{{ 'COMMON.LOADING' | translate }}</p>
  </div>

  <!-- Product Preview -->
  <div class="product-preview" *ngIf="productForm.valid && !isLoading">
    <h3>{{ 'PRODUCTS.PREVIEW' | translate }}</h3>
    <div class="preview-card">
      <div class="preview-header">
        <h4>{{ productForm.get('name')?.value || 'Product Name' }}</h4>
        <div class="preview-badge">
          <mat-chip 
            *ngIf="productForm.get('size')?.value"
            class="size-chip">
            {{ sizeOptions.find(s => s.value === productForm.get('size')?.value)?.label }}
          </mat-chip>
        </div>
      </div>
      
      <div class="preview-color" *ngIf="productForm.get('colorId')?.value">
        <div class="color-info">
          <div 
            class="color-sample"
            [style.background-color]="colors.find(c => c.id === productForm.get('colorId')?.value)?.hexCode">
          </div>
          <span>{{ colors.find(c => c.id === productForm.get('colorId')?.value)?.name }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
